# Docker Hub ë¹Œë“œ ë° ë°°í¬ ê°€ì´ë“œ

APS Admin ë°±ì—”ë“œë¥¼ Docker Hubì— ì˜¬ë¦¬ê³  ë‹¤ë¥¸ ì„œë²„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„

### 1. Docker Hub ê³„ì •
- ì‚¬ìš©ìëª…: `choho97`
- https://hub.docker.com/u/choho97

### 2. ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •

**ì´ë¯¸ ì„¤ì •ë¨** - `DOCKER_USERNAME`ì´ `choho97`ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### 3. Docker ë¡œê·¸ì¸

```bash
docker login
# Username: choho97
# Password: ********
```

## ğŸš€ ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ

### Windows (PowerShell)

```powershell
# ìµœì‹  ë²„ì „ (latest)
.\.dev-scripts\docker-build-push.ps1

# íŠ¹ì • ë²„ì „ ì§€ì •
.\.dev-scripts\docker-build-push.ps1 1.0.0
.\.dev-scripts\docker-build-push.ps1 1.0.1
```

### Linux/Mac

```bash
# ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ (ìµœì´ˆ 1íšŒ)
chmod +x .dev-scripts/docker-build-push.sh

# ìµœì‹  ë²„ì „ (latest)
./.dev-scripts/docker-build-push.sh

# íŠ¹ì • ë²„ì „ ì§€ì •
./.dev-scripts/docker-build-push.sh 1.0.0
./.dev-scripts/docker-build-push.sh 1.0.1
```

### ìŠ¤í¬ë¦½íŠ¸ ë™ì‘

1. **ë¹Œë“œ**: `backend-local/` ë””ë ‰í† ë¦¬ì—ì„œ Docker ì´ë¯¸ì§€ ë¹Œë“œ
2. **íƒœê·¸**: ì§€ì •í•œ ë²„ì „ + `latest` íƒœê·¸ ìƒì„±
3. **í‘¸ì‹œ**: Docker Hubì— ì´ë¯¸ì§€ ì—…ë¡œë“œ
4. **ì™„ë£Œ**: ë‹¤ìš´ë¡œë“œ ëª…ë ¹ì–´ ì¶œë ¥

## ğŸ“¦ ë‹¤ë¥¸ ì„œë²„ì—ì„œ ì‚¬ìš©í•˜ê¸°

### 1. ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ

```bash
# Docker Hubì—ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
docker pull choho97/aps-admin-backend:latest

# íŠ¹ì • ë²„ì „ ë‹¤ìš´ë¡œë“œ
docker pull choho97/aps-admin-backend:1.0.0
```

### 2. í•„ìˆ˜ íŒŒì¼ ì¤€ë¹„

ë‹¤ìš´ë¡œë“œë°›ì€ ì„œë²„ì— ë‹¤ìŒ íŒŒì¼ë“¤ì´ í•„ìš”í•©ë‹ˆë‹¤:

```
ì„œë²„-ë””ë ‰í† ë¦¬/
â”œâ”€â”€ .env                    # í™˜ê²½ ë³€ìˆ˜ (ë°±ì—”ë“œ ì„¤ì •)
â”œâ”€â”€ service-account.json    # GCP ì„œë¹„ìŠ¤ ê³„ì • í‚¤
â””â”€â”€ docker-compose.yml      # (ì„ íƒ) Docker Compose ì„¤ì •
```

**`.env` íŒŒì¼** ([.env.example](../backend-local/.env.example) ì°¸ê³ ):
```env
PORT=3001
ALLOWED_ORIGINS=http://localhost:5173,app://aps-admin
ALLOWED_EMAILS=admin@example.com
STORAGE_BUCKET=aps-list.appspot.com
GOOGLE_APPLICATION_CREDENTIALS=/app/service-account.json
NAVER_CLIENT_ID=...
NAVER_CLIENT_SECRET=...
ALIGO_API_KEY=...
ALIGO_USER_ID=...
ALIGO_SENDER_PHONE=...
RELAY_URL=http://136.113.67.193:3000
```

**`service-account.json`**: GCP ì„œë¹„ìŠ¤ ê³„ì • JSON íŒŒì¼

### 3. ì‹¤í–‰ ë°©ë²•

#### ë°©ë²• A: docker run (ê°„ë‹¨)

```bash
docker run -d \
  --name aps-admin-backend \
  --restart unless-stopped \
  -p 3001:3001 \
  --env-file .env \
  -v $(pwd)/service-account.json:/app/service-account.json:ro \
  choho97/aps-admin-backend:latest
```

**Windows (PowerShell)**:
```powershell
docker run -d `
  --name aps-admin-backend `
  --restart unless-stopped `
  -p 3001:3001 `
  --env-file .env `
  -v ${PWD}/service-account.json:/app/service-account.json:ro `
  choho97/aps-admin-backend:latest
```

#### ë°©ë²• B: docker-compose (ê¶Œì¥)

**docker-compose.yml** ìƒì„±:

```yaml
version: '3.8'

services:
  aps-backend:
    image: choho97/aps-admin-backend:latest
    container_name: aps-admin-backend
    restart: unless-stopped
    ports:
      - "3001:3001"
    env_file:
      - .env
    volumes:
      - ./service-account.json:/app/service-account.json:ro
    environment:
      GOOGLE_APPLICATION_CREDENTIALS: /app/service-account.json
    networks:
      - aps-network

networks:
  aps-network:
    driver: bridge
```

ì‹¤í–‰:
```bash
docker-compose up -d
```

### 4. ìƒíƒœ í™•ì¸

```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps

# ë¡œê·¸ í™•ì¸
docker logs aps-admin-backend -f

# Health check
curl http://localhost:3001/
```

## ğŸ”„ ì—…ë°ì´íŠ¸ ë°©ë²•

ìƒˆ ë²„ì „ì„ ë°°í¬í•œ í›„, ë‹¤ë¥¸ ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸:

```bash
# 1. ìƒˆ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
docker pull choho97/aps-admin-backend:latest

# 2. ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì‚­ì œ
docker stop aps-admin-backend
docker rm aps-admin-backend

# 3. ìƒˆ ì»¨í…Œì´ë„ˆ ì‹œì‘
docker-compose up -d
# ë˜ëŠ”
docker run -d --name aps-admin-backend ... (ìœ„ì˜ ëª…ë ¹ì–´ ì‚¬ìš©)
```

**docker-compose ì‚¬ìš© ì‹œ ë” ê°„ë‹¨**:
```bash
docker-compose pull   # ìƒˆ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
docker-compose up -d  # ìë™ìœ¼ë¡œ ì¬ì‹œì‘
```

## ğŸ“Š ë²„ì „ ê´€ë¦¬

### ë²„ì „ íƒœê¹… ì „ëµ

```bash
# ê°œë°œ ë²„ì „
./docker-build-push.ps1 dev

# í…ŒìŠ¤íŠ¸ ë²„ì „
./docker-build-push.ps1 1.0.0-beta

# í”„ë¡œë•ì…˜ ë²„ì „
./docker-build-push.ps1 1.0.0
./docker-build-push.ps1 1.1.0

# latestëŠ” í•­ìƒ ìµœì‹  í”„ë¡œë•ì…˜ ë²„ì „ì„ ê°€ë¦¬í‚´
```

### Docker Hubì—ì„œ ì´ë¯¸ì§€ í™•ì¸

https://hub.docker.com/r/choho97/aps-admin-backend/tags

## ğŸ” ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

### Docker Hub ì €ì¥ì†Œ ì„¤ì •

1. **Public vs Private**:
   - Public: ë¬´ë£Œ, ëˆ„êµ¬ë‚˜ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥ (ì†ŒìŠ¤ì½”ë“œë§Œ ê³µê°œ, ë¯¼ê°ì •ë³´ ì—†ìŒ)
   - Private: ìœ ë£Œ (ë¬´ë£Œ í”Œëœ: Private ì €ì¥ì†Œ 1ê°œ), ì¸ì¦ í•„ìš”

2. **ë¯¼ê° ì •ë³´**:
   - âŒ `.env` íŒŒì¼ì€ ì´ë¯¸ì§€ì— í¬í•¨ë˜ì§€ ì•ŠìŒ
   - âŒ `service-account.json`ì€ ì´ë¯¸ì§€ì— í¬í•¨ë˜ì§€ ì•ŠìŒ
   - âœ… ì†ŒìŠ¤ì½”ë“œ(`server.js`)ë§Œ í¬í•¨ë¨

3. **ì´ë¯¸ì§€ì— í¬í•¨ë˜ëŠ” ê²ƒ**:
   ```
   âœ… server.js (ì†ŒìŠ¤ì½”ë“œ)
   âœ… package.json, package-lock.json
   âœ… node_modules (ë¹Œë“œ ì‹œ ì„¤ì¹˜)
   âŒ .env (ì œì™¸ë¨)
   âŒ service-account.json (ì œì™¸ë¨)
   âŒ README.md, setup scripts (ì œì™¸ë¨)
   ```

4. **`.dockerignore` í™•ì¸**:
   ```
   .env
   .env.*
   service-account.json
   service-account.json.backup.*
   node_modules
   npm-debug.log
   .git
   .gitignore
   README.md
   docker-compose.yml
   ```

## ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„¤ì •

### OMV NAS / ë¡œì»¬ ì„œë²„ì—ì„œ ì‹¤í–‰ ì‹œ

1. **ë°©í™”ë²½ í¬íŠ¸ ê°œë°©**:
   ```bash
   sudo ufw allow 3001/tcp
   ```

2. **í”„ë¡ íŠ¸ì—”ë“œ `.env.production` ì„¤ì •**:
   ```env
   VITE_API_URL=http://192.168.0.100:3001  # NAS ì„œë²„ IP
   ```

3. **CORS ì„¤ì • í™•ì¸** (ë°±ì—”ë“œ `.env`):
   ```env
   ALLOWED_ORIGINS=http://localhost:5173,app://aps-admin
   ```

## ğŸ“ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### "docker: permission denied"

Linux/Macì—ì„œ sudo ì—†ì´ docker ì‚¬ìš©:
```bash
sudo usermod -aG docker $USER
# ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸
```

### "unauthorized: authentication required"

Docker Hub ë¡œê·¸ì¸ í•„ìš”:
```bash
docker logout
docker login
```

### "repository does not exist or may require 'docker login'"

- Docker Hubì— ì €ì¥ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
- `DOCKER_USERNAME`ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- Private ì €ì¥ì†Œì¸ ê²½ìš° ë¡œê·¸ì¸ í™•ì¸

## ğŸ”— ì°¸ê³  ë§í¬

- [Docker Hub](https://hub.docker.com/)
- [Docker ê³µì‹ ë¬¸ì„œ](https://docs.docker.com/)
- [í”„ë¡œì íŠ¸ README](../backend-local/README.md)
- [ê°œë°œ í™˜ê²½ ê°€ì´ë“œ](ê°œë°œí™˜ê²½-ì‹¤í–‰ê°€ì´ë“œ.md)
